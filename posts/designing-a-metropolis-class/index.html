<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
  
  
  
  

  

  

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.1/css/academicons.min.css" integrity="sha384-FIue+PI4SsI9XfHCz8dBLg33b0c1fMJgNU3X//L26FYbGnlSEfWmNT7zgWc2N9b6" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link href="https://www.adamgetchell.org/deep-thought.css" rel="stylesheet" />
  
  

  <title>
    
Adam&#x27;s Entropy | Designing a Metropolis Class

  </title>

  
  
  

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" integrity="sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx" crossorigin="anonymous"></script>

  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mathtex-script-type.min.js" integrity="sha384-jiBVvJ8NGGj5n7kJaiWwWp9AjC+Yh8rhZY3GtAX8yU28azcLgoRo4oukO87g7zDT" crossorigin="anonymous"></script>
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
  
  
</head>

<body class="has-background-white">
  <nav aria-label="section navigation" class="navbar is-light" role="navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item is-size-5 has-text-weight-bold" href="https:&#x2F;&#x2F;www.adamgetchell.org">Adam&#x27;s Entropy</a>
        <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-end has-text-centered">
          
          
          
          
          
          
            
            
            
            
            
          
          <a class="navbar-item has-text-weight-semibold" href="&#x2F;about">
            About
          </a>
          
          
          
          
            
            
            
              
            
            
            
          
          <a class="navbar-item has-text-weight-semibold" href="&#x2F;">
            Home
          </a>
          
          
          
          
            
            
            
            
            
          
          <a class="navbar-item has-text-weight-semibold" href="&#x2F;papers">
            Papers
          </a>
          
          
          
          
            
            
            
            
            
              
            
          
          <a class="navbar-item has-text-weight-semibold is-active" href="&#x2F;posts">
            Posts
          </a>
          
          
          
          
            
            
            
            
            
          
          <a class="navbar-item has-text-weight-semibold" href="&#x2F;projects">
            Projects
          </a>
          
          
          
          
            
            
            
            
            
          
          <a class="navbar-item has-text-weight-semibold" href="&#x2F;tags">
            Tags
          </a>
          
          
          
          <a class="navbar-item" id="nav-search" title="Search" data-target="#search-modal">
            <span class="icon">
              <i class="fas fa-search"></i>
            </span>
          </a>
          <a class="navbar-item" id="dark-mode" title="Switch to dark theme">
            <span class="icon">
              <i class="fas fa-adjust"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  
  

  
<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <article class="box">
          <h1 class="title">
            Designing a Metropolis Class
          </h1>
          <p class="subtitle"></p>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
<span class="icon-text has-text-grey">
  <span class="icon">
    <i class="fas fa-user"></i>
  </span>
  <span>Adam Getchell published on</span>
  <span class="icon">
    <i class="far fa-calendar-alt"></i>
  </span>
  <span><time datetime="2020-01-30T00:39:09-08:00">January 30, 2020</time></span>
</span>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
<span class="icon-text has-text-grey">
  <span class="icon">
    <i class="far fa-clock"></i>
  </span>
  <span>8 min,</span>
  <span class="icon">
    <i class="fas fa-pencil-alt"></i>
  </span>
  <span>1548 words</span>
</span>

            </div>
            <div class="column has-text-right-desktop">
              
              
<p>
  Tags:
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://www.adamgetchell.org/tags/cdt/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-tag"></i>
      </span>
      <span>cdt</span>
    </span>
  </a>
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://www.adamgetchell.org/tags/cgal/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-tag"></i>
      </span>
      <span>cgal</span>
    </span>
  </a>
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://www.adamgetchell.org/tags/delaunay/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-tag"></i>
      </span>
      <span>delaunay</span>
    </span>
  </a>
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://www.adamgetchell.org/tags/mcmc/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-tag"></i>
      </span>
      <span>mcmc</span>
    </span>
  </a>
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://www.adamgetchell.org/tags/metropolis-hastings/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-tag"></i>
      </span>
      <span>metropolis-hastings</span>
    </span>
  </a>
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://www.adamgetchell.org/tags/monte-carlo/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-tag"></i>
      </span>
      <span>monte-carlo</span>
    </span>
  </a>
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://www.adamgetchell.org/tags/physics/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-tag"></i>
      </span>
      <span>physics</span>
    </span>
  </a>
  
</p>

              
            </div>
          </div>
          <div class="content mt-2">
            <p><a rel="noopener nofollow noreferrer" target="_blank" href="http://arxiv.org/abs/hep-th/0105267">Causal Dynamical Triangulations</a> computes the path integral of the
quantum universe numerically.<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<p>$$I_{EH}=\int\mathcal{D}[g(M)]e^{iS_{EH}} \rightarrow  \sum \frac{1}{C_t}e^{-S_{R}}$$</p>
<p>Where $S_{EH}$ is the Einstein-Hilbert action:</p>
<p>$$S_{EH}=\int \left[\frac{1}{2\kappa}(R-2\Lambda)+\mathcal{L}_{M}\right]\sqrt{-g}d^4x$$</p>
<p>And $S_{R}$ is the Regge action:</p>
<p>$$S_{R}=\frac{1}{8\pi G}
\left[\sum_{hinges}A_i\delta_i+\Lambda\sum_{simplices}V_i\right]$$</p>
<blockquote>
<p>What is a path integral and why would I want to compute it?</p>
</blockquote>
<p>Good question! A reasonable answer will take us a bit far afield, and is the
subject of another (<em>pending</em>) post. For the sake of argument, let's proceed on
the assumption that it's something we want to compute.</p>
<p>To do this we use the <a rel="noopener nofollow noreferrer" target="_blank" href="https://grokipedia.com/page/Metropolis%E2%80%93Hastings_algorithm">Metropolis-Hastings</a> algorithm, which is a
member of a more general class of algorithms known as
<a rel="noopener nofollow noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo">Markov Chain Monte Carlo (MCMC)</a> methods, in particular random walk
Monte Carlo methods.</p>
<blockquote>
<p>Is this another long digression?</p>
</blockquote>
<p>Probably.</p>
<p>Anyways, to have good results, we need to calculate something, in this case
perturbations of that universe via <a rel="noopener nofollow noreferrer" target="_blank" href="http://www.sciencedirect.com/science/article/pii/055032139290012Z">ergodic moves</a>, performed millions of
times per simulation accurately.<sup class="footnote-reference"><a href="#2">2</a></sup></p>
<p>The simulated universe in general is an n-dimensional
<a rel="noopener nofollow noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Delaunay_triangulation">Delaunay Triangulation</a>, which is a good<sup class="footnote-reference"><a href="#5">3</a></sup> discretized n-dimensional
manifold, which allows us to do <a rel="noopener nofollow noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Regge_calculus">Regge calculus</a>, or
<a rel="noopener nofollow noreferrer" target="_blank" href="https://link.springer.com/article/10.1007/BF02733251">"General Relativity without Coordinates"</a>, conducted on said
triangulations.</p>
<p>Here is what these ergodic moves look like in 3D. By choosing to make these
moves according to the <a rel="noopener nofollow noreferrer" target="_blank" href="https://grokipedia.com/page/Metropolis%E2%80%93Hastings_algorithm">Metropolis-Hastings</a> algorithm, we effectively sample
all possible paths as the universe moves from one time step to the next.</p>
<blockquote>
<p>Which is what the path integral is?</p>
</blockquote>
<p>Exactly.</p>
<p>So, these are the moves which sample all possible (2+1) dimensional
discretized universes.</p>
<p><img src="/img/23move.png" alt="(2,3) move" />
<img src="/img/26move.png" alt="(2,6) move" />
<img src="/img/44move.png" alt="(4,4) move" /></p>
<blockquote>
<p>So how do we use these moves?</p>
</blockquote>
<p>First, let's start by generating a random, foliated triangulation with $n$
simplices and $t$ timeslices. <a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/acgetchell/CDT-plusplus/blob/develop/src/initialize.cpp">Here is a program to do that</a>.</p>
<p>A foliated triangulation is a Delaunay triangulation with two criteria:</p>
<ol>
<li>Each vertex has a time value</li>
<li>Each simplex contains vertices that differ by at most one time value</li>
</ol>
<p>In (2+1) dimensions, then, we are dealing with simplices that have 4 vertices
(<em>an n-dimensional simplex always has n+1 vertices</em>).</p>
<p>We can thus classify the
(2+1) dimensional simplex as a (3,1) simplex (<em>3 vertices on the low timeslice
and one vertex on the high timeslice</em>), a (2,2) simplex, or a (1,3) simplex.</p>
<p>Likewise, we can name the moves similarly.</p>
<p>The top move takes a (3,1) simplex and a (2,2) simplex and converts it to a
(3,1) simplex plus two (2,2) simplices. This is called a (2,3) move, and its
reverse is naturally a (3,2) move.</p>
<p>The middle move takes a (1,3) simplex and a (3,1) simplex and converts it to
three (1,3) simplices plus three (3,1) simplices. This is a (2,6) move along
with the reverse (6,2) move.</p>
<p>The bottom move takes two (1,3) simplices and two (3,1) simplices and makes
different (1,3) and (3,1) simplices. This is called a (4,4) move, and it is
its own reverse.</p>
<p>The CDT action is then based on the Regge action:</p>
<p>$$
\begin{aligned}
S^{(3)} &amp;= 2\pi k\sqrt{\alpha}N_1^{TL} + N_3^{(3,1)}\left[
-3k\operatorname{arcsinh}\left(\frac{1}{\sqrt{3}\sqrt{4\alpha+1}}\right)
-3k\sqrt{\alpha}\operatorname{arccos}\left(\frac{2\alpha+1}{4\alpha+1}\right)
-\frac{\lambda}{12}\sqrt{3\alpha+1}\right] \
&amp;\quad + N_3^{(2,2)}\left[
2k\operatorname{arcsinh}\left(\frac{2\sqrt{4\alpha+2}}{4\alpha+1}\right)
-4k\sqrt{\alpha}\operatorname{arccos}\left(-\frac{1}{4\alpha+1}\right)
-\frac{\lambda}{12}\sqrt{4\alpha+2}\right]
\end{aligned}
$$</p>
<p>This formula is the Regge action with some trigonometric identities applied
after taking the length of spacelike edges to be 1 and the length of timelike
edges to be $\alpha$. There are a few more constants thrown in for good
measure.<sup class="footnote-reference"><a href="#3">4</a></sup></p>
<p>However complex this looks, it generates a number.</p>
<p>Metropolis-Hastings then calculates the probability of making a move as:</p>
<p>$$ P=a_{1}a_{2}$$</p>
<p>Where:</p>
<p>$$ a_{1}=\frac{\text{move}[i]}{\sum_i\text{move}[i]} $$</p>
<p>And:</p>
<p>$$ a_{2}=e^{\Delta S} $$</p>
<p>$a_{1}$ is essentially the probability of making $\text{move}[i]$ versus
making all other moves, and $a_{2}$ is the change in the action caused by
making $\text{move}[i]$.</p>
<p>This comes from the fact that we are using Markov chains, which forget all
history except the previous move,<sup class="footnote-reference"><a href="#6">5</a></sup> and the principle of detailed balance,
which states that the probability of transitioning from $x\rightarrow x\prime$
equals the probability of $x\prime\rightarrow x$.</p>
<p>$a_{1}$ is easy to calculate: you just keep track of the total successful
moves of each type.</p>
<p>$a_{2}$ is likewise simple:</p>
<ul>
<li>
<p>A (2,3) move will change
$N_1^{TL}$ and $N_3^{(2,2)}$ by +1 each; a (3,2) by -1 each.</p>
</li>
<li>
<p>A (2,6) move changes $N_3^{(3,1)}$ by +4 and $N_1^{TL}$ by +2; a (6,2)
by -4 and -2 respectively.</p>
</li>
<li>
<p>A (4,4) move doesn't change the action at all; $a_2 = 1$, and only $a_1$ is
needed.</p>
</li>
</ul>
<p>By attempting a large number of moves, some of which will be accepted<sup class="footnote-reference"><a href="#7">6</a></sup> and
some of which will be rejected, we can approximate the distribution thus
producing an <a rel="noopener nofollow noreferrer" target="_blank" href="https://en.m.wikipedia.org/wiki/Statistical_ensemble_(mathematical_physics)">ensemble</a>.</p>
<blockquote>
<p>Now what?</p>
</blockquote>
<p>Now we can collect data on the various ensembles, and obtain things like
<a rel="noopener nofollow noreferrer" target="_blank" href="http://arxiv.org/abs/hep-th/0505113">spectral dimension</a>, <a rel="noopener nofollow noreferrer" target="_blank" href="http://arxiv.org/abs/1305.2932">transition amplitudes</a>, or in my case, the
<a rel="noopener nofollow noreferrer" target="_blank" href="http://www.slideshare.net/acgetchell/aps-48348528">Newtonian Limit</a>.</p>
<p>So that's the backstory (<em>modulo some digressions</em>).</p>
<p>To have results before, well, the end of the universe, we should use a fast
language, e.g. C++ together with a battle-tested library capable of manipulating
Delaunay triangulations in various dimensions, e.g. <a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/CGAL/cgal">CGAL</a>.<sup class="footnote-reference"><a href="#4">7</a></sup></p>
<p>Of course, that isn't enough, we have to write good code too. Thinking about
the problem statement (that we've spent most of this post on) conjures up
<a rel="noopener nofollow noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Design_Patterns">GoF</a> patterns such as the <a rel="noopener nofollow noreferrer" target="_blank" href="https://sourcemaking.com/design_patterns/command/cpp/2">Command Pattern</a>, the <a rel="noopener nofollow noreferrer" target="_blank" href="https://sourcemaking.com/design_patterns/strategy">Strategy Pattern</a>, plus the
<a rel="noopener nofollow noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Producer%E2%80%93consumer_problem">Producer-consumer</a> problem.</p>
<p>All which seem to have well tested, elegant solutions.</p>
<blockquote>
<p>But isn't <a rel="noopener nofollow noreferrer" target="_blank" href="https://www.manning.com/books/functional-programming-in-c-plus-plus">functional programming</a> the old/new hotness?</p>
</blockquote>
<p>We'll get into that next time!</p>
<blockquote>
<p>You didn't actually address the title of this post.</p>
</blockquote>
<p>I do need to sleep sometime.</p>
<blockquote>
<p>Fair enough.</p>
</blockquote>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>A <a rel="noopener nofollow noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Wick_rotation">Wick rotation</a> converts the factor of $i$ in the continuous path
integral to a minus sign in the discrete path integral. In the Einstein-Hilbert
action we keep $\Lambda$, the Cosmological constant, but ignore
$\mathcal{L}_{M}$,
the matter <a rel="noopener nofollow noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Lagrangian_(field_theory)">Lagrangian</a> density. In the Regge action, we are essentially
summing areas times angles for the first term plus volumes times the
Cosmological constant in the second term.</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>Or at least, enough times for the ensembles to "thermalize" into
representative distributions on which we can accurately sample the <a rel="noopener nofollow noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Posterior_probability">posterior</a>.</p>
</div>
<div class="footnote-definition" id="3"><sup class="footnote-definition-label">4</sup>
<p>$N_{1}^{TL}$ is the number of timelike links connecting vertices on
different time slices. $N_3^{(3,1)}$ is the number of (3,1) and (1,3) simplices.
$N_{3}^{(2,2)}$ is the number of (2,2) simplices. $k=\frac{1}{8\pi G_N}$, where
$G_N$ is Newton's constant. $\lambda=k*\Lambda$, where $\Lambda$ is the
Cosmological constant. See? All numbers.</p>
</div>
<div class="footnote-definition" id="4"><sup class="footnote-definition-label">7</sup>
<p>I first attempted to do this from scratch in <a rel="noopener nofollow noreferrer" target="_blank" href="https://common-lisp.net/project/slime/">Lisp</a>, <a rel="noopener nofollow noreferrer" target="_blank" href="https://clojure.org">Clojure</a>, <a rel="noopener nofollow noreferrer" target="_blank" href="https://fsharp.org">F#</a>,
and <a rel="noopener nofollow noreferrer" target="_blank" href="https://www.python.org">Python</a>. I quickly came to the realization that implementing [Delaunay
Triangulations][5] and the necessary operations was several PhDs worth
of research in its own right (<em>which, in fact, <a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/CGAL/cgal">CGAL</a> is</em>). The choice of <a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/CGAL/cgal">CGAL</a>
influenced the choice of language; <a rel="noopener nofollow noreferrer" target="_blank" href="https://www.python.org">Python</a> almost worked, but the
<a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/CGAL/cgal-swig-bindings">SWIG Python bindings</a> weren't up to the task at the time. (<em>They still lack
access to the new dD Triangulation package, which I will need for (3+1)D
path integrals.</em>)</p>
</div>
<div class="footnote-definition" id="5"><sup class="footnote-definition-label">3</sup>
<p>Good here means that the tools of differential geometry used on manifolds
in General Relativity have analogs in piecewise simplicial discrete
triangulations, i.e., triangulations are equivalent to manifolds.</p>
</div>
<div class="footnote-definition" id="6"><sup class="footnote-definition-label">5</sup>
<p>It would be almost hopelessly complex if we had to consider the entire
history of the universe to advance a single timestep!</p>
</div>
<div class="footnote-definition" id="7"><sup class="footnote-definition-label">6</sup>
<p>Alas, it isn't quite this simple because Metropolis-Hastings behaves
badly (<em>gets stuck</em>) if the acceptance ratio of moves is below ~25%.
Alternatives are needed if this is the case, which, for sufficiently large
triangulations, indeed occurs.</p>
</div>

          </div>
        </article>
      </div>
      
    </div>
  </div>
</section>


  
  <section class="modal" id="search-modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Search</p>
      </header>
      <section class="modal-card-body">
        <div class="field mb-2">
          <div class="control">
            <input class="input" id="search" placeholder="Search this website." type="search" />
          </div>
        </div>
        <div class="search-results">
          <div class="search-results__items"></div>
        </div>
      </section>
    </div>
    <button aria-label="close" class="modal-close is-large"></button>
  </section>
  


  

<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <nav class="level">
          

          

          

          

          
          
<div class="level-item has-text-centered">
  <a class="button is-black is-outlined" href="https:&#x2F;&#x2F;www.adamgetchell.org&#x2F;posts&#x2F;2016-08-11-public-identity&#x2F;">
    
    <span class="icon mr-2">
      <i class="fas fa-arrow-circle-left"></i>
    </span>
    
    Secure, Verifiable, Public Identity
    
  </a>
</div>

          

          
          
<div class="level-item has-text-centered">
  <a class="button is-black is-outlined" href="https:&#x2F;&#x2F;www.adamgetchell.org&#x2F;posts&#x2F;a-tale-of-two-test-frameworks&#x2F;">
    
    A Tale of Two Test Frameworks
    
    <span class="icon ml-2">
      <i class="fas fa-arrow-circle-right"></i>
    </span>
    
  </a>
</div>

          
        </nav>
      </div>
    </div>
  </div>
</section>



  



  
  <footer class="footer py-4">
    <div class="content has-text-centered">
      <p>
        Built with
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-code"></i>
          </span>
          <span>code</span>
        </span>
        and
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-heart"></i>
          </span>
          <span>love</span>
        </span>
      </p>
      <p>
        Powered by
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-power-off"></i>
          </span>
          <span>zola</span>
        </span>
      </p>
    </div>
  </footer>
  

  
  
  
  
  <script src="https://www.adamgetchell.org/elasticlunr.min.js"></script>
  <script src="https://www.adamgetchell.org/search_index.en.js"></script><script src="https://www.adamgetchell.org/js/site.js"></script>

  





  
  
</body>

</html>
